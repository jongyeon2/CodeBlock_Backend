# E-Learning Platform Backend - StudyBlock

## 1. 프로젝트 한 줄 요약

> **유연하고 확장 가능하도록 설계된 E-Learning 플랫폼 백엔드 서버**

이 프로젝트는 단순한 기능을 넘어, 동영상 처리, 외부 결제 연동, 안전한 동적 쿼리, 클라우드 활용 등 실무 수준의 문제 해결 경험을 담았습니다.

## 2. 프로젝트 목표

많은 온라인 서비스들이 처음부터 너무 복잡하게 만들어져, 새로운 기능을 하나 추가할 때마다 테스트하기 어렵고 예상치 못한 오류가 발생하는 문제를 겪습니다.

이 프로젝트는 그런 문제를 피하기 위해, **'계층형 아키텍처(Layered Architecture)'**를 기반으로 설계되었습니다. 특히 각 기능을 독립적인 수직 계층(`Controller`, `Service`, `Repository`)으로 구성하여, 다른 기능에 미치는 영향을 최소화하고 안정적으로 확장할 수 있는 구조를 만드는 것이 목표입니다.

## 3. 기술 스택 및 선택 이유

| 구분 | 기술 스택 | 선택 이유 |
| :--- | :--- | :--- |
| **핵심** | Spring Boot 3, Java 17 | 안정성이 검증된 최신 기술 스택을 사용하여, 빠르고 효율적으로 개발하기 위해 선택했습니다. |
| **설계 구조** | 계층형 아키텍처 (Layered Architecture) | 각 기능(`user`, `course` 등)별로 코드를 그룹화하고, 그 안에서 웹-비즈니스-데이터 계층을 명확히 분리하여 코드의 응집도와 유지보수성을 높이기 위함입니다. |
| **데이터베이스**| MySQL, Flyway, JPA, QueryDSL | 안정적인 데이터 관리를 위해 `MySQL`과 `JPA`를 사용합니다. `Flyway`로 DB 변경 이력을 관리하여 팀 작업 효율을 높이고, `QueryDSL`로 복잡한 검색 조건도 오류 없이 안전하게 처리합니다. |
| **인증** | Spring Security, JWT, OAuth2 | `JWT` 토큰 방식으로 안전한 API 환경을 구축하고, `OAuth2`로 편리한 소셜 로그인 기능을 구현합니다. |
| **외부 연동** | WebClient, AWS S3, FFmpeg | 외부 결제 API 연동 시 `WebClient`로 시스템 효율을 높이고, `AWS S3`와 `FFmpeg`으로 대용량 동영상 파일을 안정적으로 저장하고 처리합니다. |
| **문서화** | SpringDoc OpenAPI (Swagger) | API 명세를 자동으로 문서화하여, 프론트엔드 개발자와의 협업을 원활하게 합니다. |

## 4. 프로젝트 구조

이 프로젝트는 **기능별 계층형 아키텍처(Feature-based Layered Architecture)**를 따릅니다.

![기능별 계층형 아키텍처 다이어그램](docs/images/layered-architecture-2.png)

- **핵심 특징:** 전체 코드를 `user`, `course`와 같은 **기능(도메인) 단위**로 먼저 그룹화합니다.
- **내부 구조:** 각 기능 패키지 안에는 다음과 같은 전통적인 웹 애플리케이션의 계층이 존재합니다.
    1.  **Controller (Web Layer):** HTTP 요청을 받고 응답하는 API의 진입점입니다.
    2.  **Service (Business Layer):** 핵심 비즈니스 로직을 처리합니다.
    3.  **Repository (Data Access Layer):** 데이터베이스와의 통신(CRUD)을 담당합니다. `User` 클래스와 같은 JPA `Entity`를 직접 사용합니다.
- **장점:** 이 구조는 특정 기능과 관련된 모든 코드(`Controller`부터 `Repository`까지)가 한 곳에 모여있어 **코드의 응집도가 높고**, 다른 기능에 영향을 주지 않고 수정하거나 개발하기 용이합니다.

## 5. 핵심 기능

- **동영상 업로드 및 비동기 인코딩**
  1.  사용자가 원본 영상을 올리면 `AWS S3`에 저장합니다.
  2.  업로드와 동시에, 서버는 기다리지 않고 **비동기 방식**으로 영상 변환(인코딩) 작업을 시작합니다.
  3.  `FFmpeg`이 영상을 PC, 모바일 등 다양한 환경에 맞는 여러 화질(1080p, 720p 등)로 변환하여 S3에 다시 저장합니다.
- **안전한 인증 시스템**
  - 로그인 시 Access/Refresh 토큰을 발급하여 보안을 유지하고, 토큰이 만료되어도 사용자는 불편함 없이 서비스를 이용할 수 있도록 자동 갱신 기능을 구현했습니다.
  - 사용자 역할(일반 사용자, 관리자)에 따라 접근할 수 있는 API를 세밀하게 제어합니다.
- **외부 결제 연동 (토스페이먼츠)**
  - `WebClient`를 사용해 외부 결제 API 호출이 전체 서비스 성능에 영향을 주지 않도록 만들었습니다.
  - 서버에서 직접 금액을 검증하여 결제 정보가 위변조되는 것을 막습니다.
- **조건별 동적 검색 기능**
  - `QueryDSL`을 사용하여, 여러 검색 조건(카테고리, 가격 등)이 조합되더라도 SQL 오류 없이 안전하고 정확한 검색 결과를 제공합니다.

## 6. 고민과 해결 경험

- **문제:** 동영상 인코딩처럼 오래 걸리는 작업을 실시간으로 처리하면, 사용자는 응답을 하염없이 기다려야 하고 서버에도 부담이 됩니다.
- **해결:** **비동기 처리 방식**을 도입했습니다. 사용자는 파일을 올린 직후 바로 다른 작업을 할 수 있고, 서버는 백그라운드에서 여유롭게 인코딩을 수행합니다. 덕분에 사용자 경험과 시스템 효율을 모두 높일 수 있었습니다.

- **문제:** 로컬 PC, 테스트 서버, 실제 운영 서버의 환경(DB 정보, API 키 등)이 달라 설정이 복잡하고, 보안 정보가 코드에 노출될 위험이 있습니다.
- **해결:** Spring Boot의 `Profile` 기능을 사용해 환경별 설정을 분리했습니다. 특히 DB 비밀번호 같은 민감 정보는 `.gitignore` 처리된 `application-local.yml` 파일로 따로 관리하여, 소스 코드가 외부에 공개되더라도 안전하도록 설계했습니다.

## 7. 실무에서 중요하게 생각한 점

- **자동화된 API 문서:** 코드를 수정하면 API 문서도 자동으로 업데이트되도록 `Swagger`를 적용했습니다. 이를 통해 팀원 간의 소통 오류를 줄이고 개발 효율을 높였습니다.
- **일관된 예외 처리:** `GlobalExceptionHandler`를 두어, 어디서 에러가 발생하든 일관된 형식으로 처리하도록 만들었습니다. 덕분에 문제 추적이 쉬워지고, 사용자에게는 친절한 에러 메시지를 보여줄 수 있습니다.
- **DB 변경 이력 관리:** `Flyway`를 사용해 DB 구조 변경(테이블 생성, 수정 등)을 코드로 관리합니다. 새로운 팀원이 와도 명령어 한 번으로 DB를 최신 상태로 맞출 수 있어, 팀의 개발 환경을 통일하고 생산성을 높입니다.

## 8. 로컬에서 실행하기

1.  **사전 준비:**
    -   Java 17
    -   Docker & Docker Compose

2.  **프로젝트 복제 및 설정:**
    ```bash
    $ git clone https://github.com/your-username/your-repo.git
    $ cd your-repo

    # .env.example 파일을 복사해 .env 파일을 만들고, DB 정보 등을 입력합니다.
    $ cp .env.example .env
    $ vi .env
    ```

3.  **DB 등 인프라 실행:**
    ```bash
    # Docker Compose로 MySQL, FFmpeg 컨테이너를 실행합니다.
    $ docker-compose up -d
    ```

4.  **애플리케이션 실행:**
    ```bash
    # Gradle로 프로젝트를 빌드합니다.
    $ ./gradlew build

    # 빌드된 파일을 실행합니다.
    $ java -jar build/libs/studyblock-backend-0.0.1-SNAPSHOT.jar
    ```

5.  **API 문서 확인:**
    -   실행 후, 웹 브라우저에서 `http://localhost:8080/swagger-ui.html` 주소로 접속하면 API 문서를 볼 수 있습니다.

## 9. 이 프로젝트를 통해 보여주고 싶은 역량

-   유지보수와 확장을 고려한 **애플리케이션 설계 능력**.
-   **비동기 처리**로 사용자 경험과 시스템 성능을 함께 개선하는 문제 해결 능력.
-   **안전하고 견고한 인증 시스템**을 구축하고 운영해 본 경험.
-   복잡한 요구사항을 **오류 없고 읽기 좋은 코드로 구현**하는 능력.
-   Docker, AWS 등 **컨테이너 및 클라우드 기술 활용 능력**.
